<!DOCTYPE html>
    <head>
        <title>Doghead comics</title>
        <link href="stupid.css" rel="stylesheet" type="text/css"/>
        <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css" 
        rel="stylesheet">
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
        <meta charset="utf-8">
        <style>
        
            #top {
                position: fixed;
                bottom: 5em;
                right: 5em;
                width: 5em;
                
            }
            
            #content {
                position: fixed;
                bottom: 10em;
                right: 5em;
                width: 5em;
            }
        </style>
    </head>
     
    <body>
        <header class="container center padded blue">
            <div class="threequarters padded">
            <a href="index.html"><font color="white">Zhihao Hong's personal webpage</font></a>
          
            <h2 class="padded"><font>Doghead comics</font></h2>
            </div>
        </header>
        <div class="padded container center aqua">
        <div class="threequarters">
            <a class="btn rounded navy" 
            href="index.html"><h6>Home</h6></a>
            <a class="btn rounded navy" 
            href="comics_index.html"><h6>Doghead comics</h6></a>
            <a class="btn rounded white" 
            href="raccoon_comics.html"><h6>Raccoon comics</h6></a>
            <a class="btn rounded white" 
            href="gallery_armored.html"><h6>gallery</h6></a>
            <a class="btn rounded white" 
            href="makeMoney.html"><h6>JS</h6></a>
        </div>
        </div>
        
        <a class="btn glass padded" id="top" ><i class="fa fa-angle-double-up fa-3x"></i></a>
        <a class="btn glass padded" id="content" ><i class="fa fa-picture-o fa-2x" ></i></a>
        
        <div class="container center padded">
        <div class="container center threequarters">
        
            <div class=" padded third">
                <div class="silver center fill">
                <table id="comics_list"  class="center"></table>
                </div>
            </div>
            
            <div class=" padded twothirds" id="mainpanel">
                <p class= "padded silver">v0.15.2</p>
                <!--button type="button" onclick="loadXMLDoc()">Get comics List</button-->
                <div id="mainPanel" class="center"></div>
                <br><br>
                
                <br><br><br><br><br><br>
            </div>
            
        </div>
        </div>
        
        
        
    </body>

    
<script>

    $("#top").click(function() {
        $("html, body").animate({ scrollTop: 0 }, "slow");
    });
    
    $("#content").click(function() {
        $("html, body").animate({
        scrollTop:   $("#mainpanel").offset().top}, "slow");
    });
    
	$( document ).ready(function() {
		console.log( "ready!" );
		loadXMLDoc();
		getLatestIndex();
	});
	
    var currComicsIndex = 0;
    var maxComicsIndex = 0;
    
    function loadXMLDoc() {
        var xmlhttp = new XMLHttpRequest();
        xmlhttp.onreadystatechange = function() {
            if (this.readyState == 4 && this.status == 200) {
                getComicList(this);
            }
            //else alert("database not ready yet!");
        };
        xmlhttp.open("GET", "comics_db.xml", true);//get data from database
        xmlhttp.send();
    }
    
    //1. on page load, get the list of all comics from xml database.
    //show date and title of each item
    function getComicList(xml){
        var i;
        var xmlDoc = xml.responseXML;
        var table="<tr></tr>";
        var x = xmlDoc.getElementsByTagName( 'Comics');
        
        maxComicsIndex=x.length-1;
        for (i = x.length-1; i >= 0; i--) { 
            table += "<tr class='glass'><td align='left'><button onclick=getComicsMain("+
            i +
            ") class='fill white'><font color='black'>" +
            x[i].getElementsByTagName("Date")[0].childNodes[0].nodeValue +
            "  " +
            x[i].getElementsByTagName("Title")[0].childNodes[0].nodeValue +
            "<font></button></td></tr>";
        }
        document.getElementById("comics_list").innerHTML = table;
    }
    
    //2. on page load, the comics panel shows the latest comics
    function getLatestIndex(){
		getComicsMain(maxComicsIndex);
    }

    //then load the image, title, date and discription
    function getComicsMain(indexOfComics){
        currComicsIndex = indexOfComics;
        var xmlhttp = new XMLHttpRequest();
        xmlhttp.onreadystatechange = function() {
            if (xmlhttp.readyState == 4 && xmlhttp.status == 200) {
                var xmlDoc = xmlhttp.responseXML;
                var comicsArray = xmlDoc.getElementsByTagName("Comics");
                var mainPanel = "<button onclick='getPrevComic()'><i class='fa fa-arrow-left'></i> Older </button>" +
				"<button onclick='getNextComic()'> Newer <i class='fa fa-arrow-right'></i></button><h5>" +
                comicsArray[indexOfComics].getElementsByTagName("Title")[0].childNodes[0].nodeValue +
                "</h5><br><img src='/comics/"+
                comicsArray[indexOfComics].getElementsByTagName("Src")[0].childNodes[0].nodeValue +
                "'></img><br><h6>" + 
                comicsArray[indexOfComics].getElementsByTagName("Desc")[0].childNodes[0].nodeValue +
                "</h6><br><button onclick='getPrevComic()'><i class='fa fa-arrow-left'></i> Older </button>" +
				"<button onclick='getNextComic()'>Newer <i class='fa fa-arrow-right'></i></button>";
                 document.getElementById("mainPanel").innerHTML = mainPanel;
            }
            //else alert("database not ready yet!");
        };
        xmlhttp.open("GET", "comics_db.xml", true);//get data from database
        xmlhttp.send();
        
        //scroll to image position
        $("html, body").animate({
        scrollTop:   $("#mainpanel").offset().top}, "slow");
    }

    //3. when the content in the main comics panel is updated, 
    //show the mini icon, date and title of the previous and next
    //item as well as tje current one below the main panel
	
	//newer, higher index value
    function getNextComic(){
		//console.log(currComicsIndex);
		if (currComicsIndex == maxComicsIndex) alert("this is the most recent one!");
		else getComicsMain(currComicsIndex+1);
    }
	//older, lower index value
    function getPrevComic(){
		//console.log(currComicsIndex);
		if (currComicsIndex == 0) alert("this is the oldest one!");
		else getComicsMain(currComicsIndex-1);
    }

    //note: if the next of prev do not exist, leave it blank
    //or show "this is the last/first one" 




</script>
